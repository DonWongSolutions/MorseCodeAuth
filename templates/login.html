{% extends "base.html" %}

{% block title %}Login | MCPC{% endblock %}

{% block content %}
    <h2>Login</h2>

    <form method="post" action="{{ url_for('login') }}">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" required><br>
        <label for="password">Password (Morse code):</label>
        <input type="text" id="password" name="password" class="morsecodeinput" required>
        <button type="button" id="morse-button" class="morseinputbutton">Tap for Morse</button>
        <p>Use '.' for dot and '-' for dash, e.g., '....' for H.</p>
        <button type="submit" class="loginbutton">Login</button>
    </form>
    <p>Don't have an account? <a href="{{ url_for('register') }}">Register here</a>.</p>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const morseButton = document.getElementById('morse-button');
        const passwordField = document.getElementById('password');

        let audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let oscillator;
        let pressTime;

        morseButton.addEventListener('mousedown', function() {
            pressTime = new Date().getTime();

            oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime); //CHANGE FREQ HERE!!!!!

            oscillator.connect(audioContext.destination);
            oscillator.start();
        });

        morseButton.addEventListener('mouseup', function() {
            const releaseTime = new Date().getTime();
            const duration = releaseTime - pressTime;

            oscillator.stop();
            oscillator.disconnect();

            const dotDashThreshold = 300; //CAN CHANGE THRESHOLD HERE!!!!!!

            if (duration < dotDashThreshold) {
                passwordField.value += '.';
            } else {
                passwordField.value += '-';
            }

            pressTime = undefined;
        });
    });
    </script>
{% endblock %}