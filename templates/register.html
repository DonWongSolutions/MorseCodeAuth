{% extends "base.html" %}

{% block title %}Register | MCPC{% endblock %}

{% block content %}
<div class="register-container">
    <h2 align="center">Register</h2>
    <form method="post" action="{{ url_for('register') }}">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username" class='formsinput' required><br>

        <label for="password">Password (Morse code):</label>
        <input type="text" id="password" name="password" class="morsecodeinput" required oninput="validateMorseCode(this)">

        <div class="large-screen">
            <button type="button" id="morse-button" class="morseinputbutton">Tap for Morse</button>
        </div>

        <div class="small-screen">
            <button type="button" id="dot-button" class="morseinputbutton">Dot</button>
            <button type="button" id="dash-button" class="morseinputbutton">Dash</button>
        </div>

        <p>Use '.' for dot and '-' for dash, e.g., '....' for H.</p>
        <p id="error-message" style="color:red"></p>

        <button type="submit" class="loginbutton">Register</button>
    </form>

    <p>Already have an account? <a href="{{ url_for('login') }}">Login here</a>.</p>
</div>
    <style>
      /* CSS to hide/show based on screen size */
      .large-screen { display: none; }
      .small-screen { display: block; }

      @media (min-width: 768px) {
        /* Change breakpoint as needed */
        .large-screen { display: block; }
        .small-screen { display: none; }
      }
    </style>

    <script>
    function validateMorseCode(input) {
        const regex = /^[ .\-]*$/;
        const isValid = regex.test(input.value);
        const errorMessage = document.getElementById("error-message");
        if (!isValid) {
            errorMessage.textContent = "Password must contain only dots (.) and dashes (-).";
            return false;
        } else {
            errorMessage.textContent = "";
            return true;
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        const passwordField = document.getElementById('password');

        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        let oscillator;
        let pressTime;

        const startOscillator = () => {
            oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
        };

        const stopOscillator = () => {
            oscillator.stop();
            oscillator.disconnect();
        };

        const morseButton = document.getElementById('morse-button');
        morseButton.addEventListener('mousedown', function() {
            pressTime = new Date().getTime();
            startOscillator();
        });

        morseButton.addEventListener('mouseup', function() {
            const releaseTime = new Date().getTime();
            const duration = releaseTime - pressTime;
            stopOscillator();
            const dotDashThreshold = 300;

            if (duration < dotDashThreshold) {
                passwordField.value += '.';
            } else {
                passwordField.value += '-';
            }

            pressTime = undefined;
        });

        const dotButton = document.getElementById('dot-button');
        const dashButton = document.getElementById('dash-button');

        dotButton.addEventListener('click', function() {
            passwordField.value += '.';
        });

        dashButton.addEventListener('click', function() {
            passwordField.value += '-';
        });
    });
    </script>
{% endblock %}